<div class="flex h-screen bg-gray-50">

  <!-- SIDEBAR -->
  <aside class="w-80 bg-white border-r border-gray-200 shadow-sm overflow-y-auto hidden md:block">
    <div class="sticky top-0 bg-white z-10 border-b border-gray-200">
      <a 
        routerLink="/" 
        class="flex items-center px-6 py-5 hover:bg-gray-50 transition-colors group"
      >
        <!-- Logo Google Colors -->
        <div class="flex items-center space-x-1 mr-4">
          <div class="w-2 h-2 rounded-full bg-[#4285F4]"></div>
          <div class="w-2 h-2 rounded-full bg-[#EA4335]"></div>
          <div class="w-2 h-2 rounded-full bg-[#34A853]"></div>
          <div class="w-2 h-2 rounded-full bg-[#FBBC04]"></div>
        </div>
        <h2 class="text-2xl font-bold text-gray-800 group-hover:text-gray-900 transition-colors">
          Sessions DevFest
        </h2>
      </a>
    </div>

    <ul class="p-3">
      @for (s of sessions(); track s.id) {
        <li 
          class="px-4 py-4 rounded-xl transition-all duration-300 mb-2"
          (click)="selectSession(s)"
          [class]="s.isActive 
            ? 'bg-white shadow-sm border border-gray-100 hover:shadow-md hover:border-blue-200 cursor-pointer' 
            : 'bg-gray-50 opacity-60 cursor-not-allowed'"
        >
          <div class="flex items-center justify-between">
            <div class="flex-1 min-w-0">
              <p class="font-semibold text-gray-800 truncate">{{ s.speaker }}</p>
              <p class="text-gray-500 text-sm mt-1 line-clamp-2">{{ s.title }}</p>
            </div>

            @if (s.isActive) {
              <div class="flex items-center ml-3">
                <div class="w-2 h-2 rounded-full bg-[#34A853] animate-pulse mr-2"></div>
                <span class="text-xs text-[#34A853] font-medium">Live</span>
              </div>
            }
          </div>
        </li>
      }
    </ul>
  </aside>

  <!-- Mobile Header -->
  <div class="md:hidden fixed top-0 left-0 right-0 bg-white border-b border-gray-200 z-20 shadow-sm">
    <div class="flex items-center px-4 py-3">
      <a 
        routerLink="/" 
        class="flex items-center mr-4 p-2 hover:bg-gray-100 rounded-lg transition-colors"
      >
        <!-- Logo Google Colors Mobile -->
        <div class="flex items-center space-x-1">
          <div class="w-1.5 h-1.5 rounded-full bg-[#4285F4]"></div>
          <div class="w-1.5 h-1.5 rounded-full bg-[#EA4335]"></div>
          <div class="w-1.5 h-1.5 rounded-full bg-[#34A853]"></div>
          <div class="w-1.5 h-1.5 rounded-full bg-[#FBBC04]"></div>
        </div>
      </a>
      <select 
        (change)="onMobileSessionSelect($event)"
        class="flex-1 border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-[#4285F4] focus:border-[#4285F4]"
      >
        <option value="">S√©lectionnez une session</option>
        @for (s of sessions(); track s.id) {
          @if (s.isActive) {
            <option [value]="s.id">{{ s.speaker }} - {{ s.title }}</option>
          }
        }
      </select>
    </div>
  </div>

  <!-- Zone de questions -->
  <section class="flex-1 flex flex-col md:pt-0 pt-16 relative">

    <!-- Overlay pour les r√©actions anim√©es -->
    <div class="absolute inset-0 pointer-events-none overflow-hidden z-30">
      @for (reaction of activeReactions(); track reaction.id) {
        <div 
          class="absolute text-4xl pointer-events-none animate-float"
          [style.left]="reaction.startX + 'px'"
          [style.bottom]="reaction.startY + 'px'"
          [class]="reaction.animationClass"
        >
          {{ reaction.emoji }}
        </div>
      }
    </div>

    @if (!selectedSession()) {
      <div class="flex-1 flex items-center justify-center p-6">
        <div class="text-center max-w-4xl">
          <div class="w-20 h-20 bg-gray-200 rounded-full flex items-center justify-center mx-auto mb-4">
            <svg class="w-10 h-10 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"/>
            </svg>
          </div>
          <h3 class="text-xl font-semibold text-gray-700 mb-2">Aucune session s√©lectionn√©e</h3>
          <p class="text-gray-500">
            Choisissez une session active depuis le menu pour voir ou poser des questions.
          </p>
        </div>
      </div>
    } @else {

      <!-- Header de session -->
      <div class="bg-white border-b border-gray-200 px-6 py-4 shadow-sm">
        <div class="flex items-center justify-between">
          <div>
            <h2 class="text-2xl font-bold text-gray-800 leading-tight">
              {{ selectedSession()?.title }}
            </h2>
            <p class="text-gray-600 mt-1">{{ selectedSession()?.speaker }}</p>
          </div>
          <div class="flex items-center space-x-2">
            <div class="w-3 h-3 rounded-full bg-[#34A853] animate-pulse"></div>
            <span class="text-sm text-[#34A853] font-medium">En direct</span>
          </div>
        </div>
      </div>

      <!-- Questions d√©j√† pos√©es -->
      <div class="max-w-7xl flex-1 overflow-y-auto p-6 bg-gray-50/50">
        <div class="max-w-4xl mx-auto h-full flex flex-col">
          <h3 class="text-lg font-semibold text-gray-700 mb-6 px-2">Questions r√©centes</h3>

          @if ((selectedSession()?.questions ?? []).length === 0) {
            <div class="flex-1 flex items-center justify-center">
              <div class="text-center">
                <div class="w-16 h-16 bg-gray-200 rounded-full flex items-center justify-center mx-auto mb-4">
                  <svg class="w-8 h-8 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                  </svg>
                </div>
                <p class="text-gray-500 italic">Aucune question pour l'instant. Soyez le premier √† en poser une !</p>
              </div>
            </div>
          } @else {
            <!-- Container des questions avec d√©filement automatique vers le bas -->
            <div 
              #questionsContainer
              class="flex-1 overflow-y-auto space-y-4 pb-4"
            >
              @for (q of selectedSession()?.questions ?? []; track q.time) {
                <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-4 hover:shadow-md transition-shadow duration-300 ">
                  <div class="flex justify-between items-start">
                    <p class="text-gray-700 flex-1">{{ q.contenu }}</p>
                    <div class="flex space-x-1 ml-3">
                      @for (reaction of q.reactions || []; track reaction.emoji) {
                        <button 
                          (click)="addReaction(q, reaction.emoji)"
                          class="flex items-center space-x-1 px-2 py-1 rounded-full bg-gray-100 hover:bg-gray-200 transition-colors text-sm"
                        >
                          <span>{{ reaction.emoji }}</span>
                          <span class="text-gray-600">{{ reaction.count }}</span>
                        </button>
                      }
                    </div>
                  </div>
                  <div class="flex justify-between items-center mt-3">
                    <p class="text-xs text-gray-400">
                      {{ formatTime(q.time) }}
                    </p>
                 
                  </div>

                  <!-- Panel de r√©actions √©tendu -->
                  @if (showReactionPicker) {
                    <div class="mt-3 pt-3 border-t border-gray-100">
                      <div class="flex flex-wrap gap-2">
                        @for (emoji of availableEmojis; track emoji) {
                          <button
                            (click)="triggerFloatingReaction(emoji); showReactionPicker = false"
                            class="text-xl hover:scale-125 transition-transform duration-200 p-2 rounded-lg hover:bg-gray-100"
                          >
                            {{ emoji }}
                          </button>
                        }
                      </div>
                    </div>
                  }
                </div>
              }
              
              <!-- Element invisible pour le scroll automatique -->
              <div #scrollAnchor></div>
            </div>
          }
        </div>
      </div>

      <!-- Form de question -->
      <div class="bg-white border-t border-gray-200 p-6 shadow-lg  ">
        <div class="max-w-4xl mx-auto">
          <div class="relative ">
            <textarea
              [ngModel]="questionText()"
              (ngModelChange)="questionText.set($event)"
              rows="3"
              placeholder="√âcrivez votre question..."
              class="w-full border border-gray-300 rounded-xl p-4 pr-24 focus:ring-2 focus:ring-[#4285F4] focus:border-[#4285F4] resize-none shadow-sm transition-all duration-200"
            ></textarea>

            <div class="absolute bottom-3 right-3 flex space-x-2">
              

              <button
                (click)="toggleEmojiPanel()"
                class="p-2 text-gray-400 hover:text-[#4285F4] hover:bg-blue-50 rounded-lg transition-colors"
                type="button"
              >
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
              </button>

              <button
                (click)="toggleReactEmojiPanel()"
                class="p-2 text-gray-400 hover:text-[#4285F4] hover:bg-blue-50 rounded-lg transition-colors"
                type="button"
              >
                R√©agir
              </button>
              
              <button
                (click)="submitQuestion()"
                [disabled]="!questionText().trim()"
                class="px-6 py-2 bg-[#4285F4] text-white rounded-lg shadow-sm hover:bg-[#3367D6] hover:shadow-md transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed font-medium"
              >
                Envoyer
              </button>
            </div>
          </div>

          <!-- Panel d'emojis pour le textarea -->
          @if (showEmojiPanel()) {
            <div class="mt-3 p-4 bg-white border border-gray-200 rounded-xl shadow-lg question-card">
              <div class="flex flex-wrap gap-2">
                @for (emoji of availableEmojis; track emoji) {
                  <button
                    (click)="addEmojiToText(emoji)"
                    class="text-xl hover:scale-125 transition-transform duration-200 p-2 rounded-lg hover:bg-gray-100"
                  >
                    {{ emoji }}
                  </button>
                }
              </div>
            </div>
          }

          @if (showReactEmojiPanel()) {
            <div class="mt-3 p-4 bg-white border border-gray-200 rounded-xl shadow-lg question-card">
              <div class="flex flex-wrap gap-2">
                  <!-- üëç -->
                  <button 
                    (click)="triggerFloatingReaction('üëç')"
                    class="text-gray-400 hover:text-[#4285F4] transition-all p-1 rounded-lg hover:bg-gray-100 text-2xl hover:scale-125"
                    title="R√©agir avec üëç"
                  >
                    üëç
                  </button>

                  <!-- ‚ù§Ô∏è -->
                  <button 
                    (click)="triggerFloatingReaction('‚ù§Ô∏è')"
                    class="text-gray-400 hover:text-[#EA4335] transition-all p-1 rounded-lg hover:bg-gray-100 text-2xl hover:scale-125"
                    title="R√©agir avec ‚ù§Ô∏è"
                  >
                    ‚ù§Ô∏è
                  </button>

                  <!-- üéâ -->
                  <button 
                    (click)="triggerFloatingReaction('üéâ')"
                    class="text-gray-400 hover:text-[#FBBC04] transition-all p-1 rounded-lg hover:bg-gray-100 text-2xl hover:scale-125"
                    title="R√©agir avec üéâ"
                  >
                    üéâ
                  </button>

                  <!-- ü§î -->
                  <button 
                    (click)="triggerFloatingReaction('ü§î')"
                    class="text-gray-400 hover:text-blue-500 transition-all p-1 rounded-lg hover:bg-gray-100 text-2xl hover:scale-125"
                    title="R√©agir avec ü§î"
                  >
                    ü§î
                  </button>

                  <!-- üëÄ -->
                  <button 
                    (click)="triggerFloatingReaction('üëÄ')"
                    class="text-gray-400 hover:text-purple-500 transition-all p-1 rounded-lg hover:bg-gray-100 text-2xl hover:scale-125"
                    title="R√©agir avec üëÄ"
                  >
                    üëÄ
                  </button>

                  <!-- üôå -->
                  <button 
                    (click)="triggerFloatingReaction('üôå')"
                    class="text-gray-400 hover:text-green-500 transition-all p-1 rounded-lg hover:bg-gray-100 text-2xl hover:scale-125"
                    title="R√©agir avec üôå"
                  >
                    üôå
                  </button>

                  <!-- üòÖ -->
                  <button 
                    (click)="triggerFloatingReaction('üòÖ')"
                    class="text-gray-400 hover:text-yellow-500 transition-all p-1 rounded-lg hover:bg-gray-100 text-2xl hover:scale-125"
                    title="R√©agir avec üòÖ"
                  >
                    üòÖ
                  </button>

                  <!-- üî• -->
                  <button 
                    (click)="triggerFloatingReaction('üî•')"
                    class="text-gray-400 hover:text-red-500 transition-all p-1 rounded-lg hover:bg-gray-100 text-2xl hover:scale-125"
                    title="R√©agir avec üî•"
                  >
                    üî•
                  </button>

                  <!-- ‚ú® -->
                  <button 
                    (click)="triggerFloatingReaction('‚ú®')"
                    class="text-gray-400 hover:text-pink-500 transition-all p-1 rounded-lg hover:bg-gray-100 text-2xl hover:scale-125"
                    title="R√©agir avec ‚ú®"
                  >
                    ‚ú®
                  </button>

                  <!-- ü§© -->
                  <button 
                    (click)="triggerFloatingReaction('ü§©')"
                    class="text-gray-400 hover:text-yellow-600 transition-all p-1 rounded-lg hover:bg-gray-100 text-2xl hover:scale-125"
                    title="R√©agir avec ü§©"
                  >
                    ü§©
                  </button>

                  <!-- üòç -->
                  <button 
                    (click)="triggerFloatingReaction('üòç')"
                    class="text-gray-400 hover:text-red-400 transition-all p-1 rounded-lg hover:bg-gray-100 text-2xl hover:scale-125"
                    title="R√©agir avec üòç"
                  >
                    üòç
                  </button>

                  <!-- üò≠ -->
                  <button 
                    (click)="triggerFloatingReaction('üò≠')"
                    class="text-gray-400 hover:text-blue-400 transition-all p-1 rounded-lg hover:bg-gray-100 text-2xl hover:scale-125"
                    title="R√©agir avec üò≠"
                  >
                    üò≠
                  </button>

                  <!-- üòé -->
                  <button 
                    (click)="triggerFloatingReaction('üòé')"
                    class="text-gray-400 hover:text-black transition-all p-1 rounded-lg hover:bg-gray-100 text-2xl hover:scale-125"
                    title="R√©agir avec üòé"
                  >
                    üòé
                  </button>

                  <!-- üí° -->
                  <button 
                    (click)="triggerFloatingReaction('üí°')"
                    class="text-gray-400 hover:text-amber-500 transition-all p-1 rounded-lg hover:bg-gray-100 text-2xl hover:scale-125"
                    title="R√©agir avec üí°"
                  >
                    üí°
                  </button>

                  <!-- üëè -->
                  <button 
                    (click)="triggerFloatingReaction('üëè')"
                    class="text-gray-400 hover:text-blue-400 transition-all p-1 rounded-lg hover:bg-gray-100 text-2xl hover:scale-125"
                    title="R√©agir avec üëè"
                  >
                    üëè
                  </button>

                  <!-- ‚≠ê -->
                  <button 
                    (click)="triggerFloatingReaction('‚≠ê')"
                    class="text-gray-400 hover:text-yellow-500 transition-all p-1 rounded-lg hover:bg-gray-100 text-2xl hover:scale-125"
                    title="R√©agir avec ‚≠ê"
                  >
                    ‚≠ê
                  </button>

              </div>

            </div>
          }

          
        </div>
      </div>

    }
  </section>

</div>