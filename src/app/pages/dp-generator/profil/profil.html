<div class="bg-white rounded-2xl shadow-lg p-6 md:p-8">
  <h3 class="text-xl md:text-2xl font-bold text-center text-gray-900 mb-6 md:mb-8">
    Aperçu de votre Photo de Profil
  </h3>

  <div class="flex justify-center">
    @if (uiState === 'initial') {
    <div
      class="relative w-64 h-64 md:w-80 md:h-80 flex items-center justify-center bg-gray-50 rounded-full border-2 border-dashed border-gray-300 animate-pulse"
    >
      <p class="text-gray-500 font-medium">Votre PFP apparaîtra ici...</p>
    </div>
    } @else {
    <div
      id="dp-capture-zone-profile"
      class="relative w-64 h-64 md:w-80 md:h-80 rounded-full flex items-center justify-center transition-colors duration-300"
      [ngClass]="{
        'bg-amber-500/20 backdrop-blur-sm': profileTheme === 'yellow',
        'bg-blue-500/20 backdrop-blur-sm': profileTheme === 'blue',
        'bg-green-500/20 backdrop-blur-sm': profileTheme === 'green',
        'bg-red-500/20 backdrop-blur-sm': profileTheme === 'red'
      }"
    >
      <!-- 
          CORRECTION ICI : On retire la condition redondante.
          L'animation se déclenche car l'élément est ajouté au DOM avec ces classes.
        -->
      <div
        class="relative w-[85%] h-[85%] rounded-full overflow-hidden flex items-center justify-center bg-gray-200 z-20 transition-transform duration-300 ease-out scale-100"
      >
        <img
          [src]="previewImage"
          alt="Preview"
          class="absolute inset-0 w-full h-full object-cover"
        />
      </div>

      <!-- Le badge DevFest Kivu qui glisse du haut -->
      <div
        class="absolute top-4 left-1/2 -translate-x-1/2 z-30 bg-white border border-gray-300 px-3 py-1 rounded-full text-base font-semibold shadow transition-all duration-500 ease-out delay-100"
        [ngClass]="{
          'text-amber-600': profileTheme === 'yellow',
          'text-blue-600': profileTheme === 'blue',
          'text-green-600': profileTheme === 'green',
          'text-red-600': profileTheme === 'red'
        }"
        [class.opacity-100]="uiState === 'templateVisible'"
        [class.translate-y-0]="uiState === 'templateVisible'"
        [class.opacity-0]="uiState !== 'templateVisible'"
        [class.-translate-y-20]="uiState !== 'templateVisible'"
      >
        DevFest Kivu
      </div>

      <!-- CADRES CONDITIONNELS -->
      @if (profileStyle === 'classic') {
      <!-- Le cadre 'border.png' qui s'assemble -->
      <img
        src="assets/border.png"
        alt="Cadre décoratif"
        class="absolute inset-0 w-full h-full object-contain z-10 transition-all duration-500 ease-out delay-100"
        [class.opacity-100]="uiState === 'templateVisible'"
        [class.scale-100]="uiState === 'templateVisible'"
        [class.rotate-0]="uiState === 'templateVisible'"
        [class.opacity-0]="uiState !== 'templateVisible'"
        [class.scale-50]="uiState !== 'templateVisible'"
        [class.-rotate-45]="uiState !== 'templateVisible'"
      />
      } @else {
      <!-- Les crochets du style minimaliste -->
      <div
        class="absolute top-8 left-8 w-16 h-8 rounded-tl-2xl border-t-4 border-l-4 z-10 transition-all duration-500 ease-out delay-150"
        [ngClass]="{
          'border-amber-500': profileTheme === 'yellow',
          'border-blue-500': profileTheme === 'blue',
          'border-green-500': profileTheme === 'green',
          'border-red-500': profileTheme === 'red'
        }"
        [class.opacity-100]="uiState === 'templateVisible'"
        [class.translate-x-0]="uiState === 'templateVisible'"
        [class.translate-y-0]="uiState === 'templateVisible'"
        [class.opacity-0]="uiState !== 'templateVisible'"
        [class.-translate-x-8]="uiState !== 'templateVisible'"
        [class.-translate-y-8]="uiState !== 'templateVisible'"
      ></div>
      <div
        class="absolute bottom-8 right-8 w-16 h-8 rounded-br-2xl border-b-4 border-r-4 z-10 transition-all duration-500 ease-out delay-150"
        [ngClass]="{
          'border-amber-500': profileTheme === 'yellow',
          'border-blue-500': profileTheme === 'blue',
          'border-green-500': profileTheme === 'green',
          'border-red-500': profileTheme === 'red'
        }"
        [class.opacity-100]="uiState === 'templateVisible'"
        [class.translate-x-0]="uiState === 'templateVisible'"
        [class.translate-y-0]="uiState === 'templateVisible'"
        [class.opacity-0]="uiState !== 'templateVisible'"
        [class.translate-x-8]="uiState !== 'templateVisible'"
        [class.translate-y-8]="uiState !== 'templateVisible'"
      ></div>
      }

      <!-- Le badge du nom qui apparaît en fondu -->
      <div
        class="absolute bottom-6 left-1/2 -translate-x-1/2 z-30 text-white px-4 py-1 rounded-full text-lg font-semibold transition-all duration-300 ease-out delay-300"
        [ngClass]="{
          'bg-amber-600': profileTheme === 'yellow',
          'bg-blue-600': profileTheme === 'blue',
          'bg-green-600': profileTheme === 'green',
          'bg-red-600': profileTheme === 'red'
        }"
        [class.opacity-100]="uiState === 'templateVisible' && fullName"
        [class.opacity-0]="uiState !== 'templateVisible' || !fullName"
      >
        {{ fullName }}
      </div>
    </div>
    }
  </div>

  <p class="text-center mt-6 md:mt-8 text-gray-600 text-xs md:text-sm">
    Votre photo sera exportée en PNG circulaire avec le cadre de motif.
  </p>
</div>
