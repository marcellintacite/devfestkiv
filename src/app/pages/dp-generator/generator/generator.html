<div class="bg-white rounded-2xl border-2 border-gray-200 p-4 sm:p-6 md:p-8">
  <h3 class="text-xl md:text-2xl font-bold text-center text-gray-900 mb-6 md:mb-8">
    Aperçu de votre DP de Publication
  </h3>

  <div class="w-full flex justify-center">
    <div
      class="origin-center transform scale-[0.35] sm:scale-[0.5] md:scale-[0.6] lg:scale-[0.7] xl:scale-[0.8] transition-transform duration-300 mx-auto"
    >
      <!-- ACTE I : Le placeholder initial -->
      @if (uiState === 'initial') {
      <div
        class="relative w-[837px] h-[837px] flex flex-col items-center justify-center bg-gray-50 rounded-2xl border-2 border-dashed border-gray-300 animate-pulse"
      >
        <svg class="w-24 h-24 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="1"
            d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"
          ></path>
        </svg>
        <p class="mt-4 text-2xl text-gray-500 font-medium">Votre création apparaîtra ici...</p>
      </div>
      } @else {
      <!-- ACTES III & IV : La zone de capture qui s'anime -->
      <div
        id="dp-capture-zone-generator"
        class="relative w-[837px] h-[837px] overflow-hidden transition-colors duration-300"
        [class.bg-primary-pastel]="generatorTheme === 'default'"
        [class.bg-yellow-50]="generatorTheme === 'white'"
      >
        <!-- Le cadre de fond : fondu rapide -->
        <img
          src="assets/dp-layout.png"
          alt="Cadre de fond DevFest"
          class="absolute inset-0 w-full h-full object-cover z-0 transition-opacity duration-300 ease-in"
          [class.opacity-100]="uiState === 'templateVisible'"
          [class.opacity-0]="uiState !== 'templateVisible'"
        />

        <!-- Bloc citation et flèche : slide depuis la gauche avec rebond -->
        <div
          class="absolute top-40 left-24 w-[286px] z-20 transition-all duration-500 ease-out"
          [class.opacity-100]="uiState === 'templateVisible'"
          [class.translate-x-0]="uiState === 'templateVisible'"
          [class.opacity-0]="uiState !== 'templateVisible'"
          [class.-translate-x-full]="uiState !== 'templateVisible'"
        >
          <div class="relative bg-primary border-4 border-accent p-8 rounded-2xl shadow-lg">
            <p class="text-gray-800 text-3xl italic text-center leading-tight break-words">
              "{{ quote || 'Le code est ma poésie.' }}"
            </p>
            <div
              class="absolute left-full top-1/2 -translate-y-1/2 w-0 h-0 border-t-[15px] border-t-transparent border-b-[15px] border-b-transparent border-l-[20px] border-l-accent"
            ></div>
          </div>
        </div>
        <div
          class="absolute top-80 left-24 w-[286px] z-20 mt-4 ml-4 space-y-2 transition-all duration-500 ease-out delay-100"
          [class.opacity-100]="uiState === 'templateVisible'"
          [class.translate-x-0]="uiState === 'templateVisible'"
          [class.opacity-0]="uiState !== 'templateVisible'"
          [class.-translate-x-full]="uiState !== 'templateVisible'"
        >
          <p class="text-2xl font-light">
            <span class="bg-secondary text-white px-3 py-1 rounded-md">@{{ fullName }}</span>
            <span
              class="text-text px-3 py-1 rounded-md"
              [ngClass]="{
                'bg-white': generatorTheme === 'default',
                'bg-gray-100': generatorTheme === 'white'
              }"
              >sera au :</span
            >
          </p>
          <img
            src="assets/arrow.png"
            alt="fleche"
            class="w-30 h-48 object-contain -rotate-23 ml-10"
          />
        </div>

        <!-- Bloc d'infos DevFest : slide depuis le bas -->
        <div
          class="absolute bottom-28 left-1/2 -translate-x-1/2 flex flex-col items-center gap-4 z-10 transition-all duration-500 ease-out delay-150"
          [class.opacity-100]="uiState === 'templateVisible'"
          [class.translate-y-0]="uiState === 'templateVisible'"
          [class.opacity-0]="uiState !== 'templateVisible'"
          [class.translate-y-full]="uiState !== 'templateVisible'"
        >
          <div class="flex flex-col items-center">
            <img src="assets/logo-1.png" alt="Devfest Big Logo" class="w-64" />
          </div>
          <div
            class="flex py-4 rounded-2xl px-4 shadow-md border-2 border-accent h-20 w-[460px] items-center"
            [ngClass]="{
              'bg-background': generatorTheme === 'default',
              'bg-primary': generatorTheme === 'white'
            }"
          >
            <!-- Section Date et Heure -->
            <div class="flex-1 flex items-center gap-2 min-w-0">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
                stroke-width="1.5"
                stroke="currentColor"
                class="w-6 h-6 flex-shrink-0"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 012.25-2.25h13.5A2.25 2.25 0 0121 7.5v11.25m-18 0A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75m-18 0v-7.5A2.25 2.25 0 015.25 9h13.5A2.25 2.25 0 0121 11.25v7.5"
                />
              </svg>
              <div class="flex flex-col min-w-0">
                <p class="text-sm font-bold tracking-wider truncate">
                  {{ eventConfig.date.display.start }} {{ eventConfig.date.display.month }}
                  {{ eventConfig.date.display.year }}
                </p>
                <p class="text-sm font-light truncate">09:00</p>
              </div>
            </div>

            <!-- Ligne de séparation -->
            <div class="border-l border-text h-10 mx-2"></div>

            <!-- Section Lieu -->
            <div class="flex-1 flex items-center gap-2 min-w-0">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
                stroke-width="1.5"
                stroke="currentColor"
                class="w-6 h-6 flex-shrink-0"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="M15 10.5a3 3 0 11-6 0 3 3 0 016 0z"
                />
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1115 0z"
                />
              </svg>
              <div class="flex flex-col min-w-0">
                <p class="text-sm font-bold tracking-wider truncate">salle INPP Labotte</p>
                <p class="text-sm font-light truncate">Sud-Kivu</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Logo circulaire : pop-in -->
        <div
          class="absolute bottom-27 bg-text left-15 w-28 h-28 rounded-full flex items-center justify-center shadow-lg z-30 transition-transform duration-300 ease-out delay-200"
          [class.scale-100]="uiState === 'templateVisible'"
          [class.scale-0]="uiState !== 'templateVisible'"
        >
          <img src="assets/logo.png" alt="Logo DevFest" class="w-24 object-contain m-0" />
        </div>

        <!-- La photo de l'utilisateur : zoom-in agressif -->
        <div
          class="absolute top-24 left-[425px] w-[286px] h-[392px] bg-gray-300 rounded-3xl shadow-2xl overflow-hidden flex items-center justify-center z-10 border-4 border-accent transition-transform duration-300 ease-in-out"
          [class.scale-100]="uiState === 'imageVisible' || uiState === 'templateVisible'"
          [class.scale-0]="!(uiState === 'imageVisible' || uiState === 'templateVisible')"
        >
          <img
            [src]="previewImage"
            alt="Aperçu de l'utilisateur"
            class="w-full h-full object-cover"
          />
        </div>
      </div>
      }
    </div>
  </div>
</div>
